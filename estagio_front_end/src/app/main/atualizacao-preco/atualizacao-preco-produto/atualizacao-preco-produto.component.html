<p-table
  #produtosTable
  [value]="produtos"
  [lazy]="true"
  [paginator]="true"
  [rows]="rows"
  [(selection)]="selectedProdutos"
  [totalRecords]="totalProdutos"
  sortMode="multiple"
  [rowsPerPageOptions]="[5, 10, 20]"
  (onLazyLoad)="loadProdutos($event)"
>
  <ng-template pTemplate="caption">
    <div class="flex flex-row">
      <p-floatLabel>
        <p-dropdown
          [options]="tipoAtualizacaoOptions"
          [(ngModel)]="atualizacao.atualizaPreco"
          [showClear]="true"
          placeholder="Metodo de Atualização"
        >
          <ng-template let-item pTemplate="item">
            {{ item.label | titlecase }}
          </ng-template>
          <ng-template pTemplate="selectedItem">
            <div style="width: 125px; height: fit-content">
              {{
                this.tipoAtualizacaoOptions[this.atualizacao.atualizaPreco!]
                  .label | titlecase
              }}
            </div>
          </ng-template>
        </p-dropdown>
      </p-floatLabel>
      <div>
        <p-button
          *ngIf="atualizacao.isRelativo"
          label="Relativo"
          (onClick)="atualizacao.isRelativo = !atualizacao.isRelativo"
        />
        <p-button
          *ngIf="!atualizacao.isRelativo"
          label="Absoluto"
          severity="secondary"
          (onClick)="atualizacao.isRelativo = !atualizacao.isRelativo"
        />
      </div>
      <p-floatLabel>
        <p-inputNumber
          *ngIf="!atualizacao.isPercentual && atualizacao.atualizaPreco != 0"
          [(ngModel)]="valor"
          inputId="valor"
          mode="currency"
          currency="BRL"
          [minFractionDigits]="2"
          [maxFractionDigits]="2"
        />
        <p-inputNumber
          *ngIf="atualizacao.isPercentual && atualizacao.atualizaPreco != 0"
          [(ngModel)]="valor"
          inputId="valor"
          mode="decimal"
          suffix="%"
          [minFractionDigits]="2"
          [maxFractionDigits]="2"
        />
        <p-inputNumber
          *ngIf="atualizacao.atualizaPreco == 0"
          [(ngModel)]="valor"
          inputId="valor"
          mode="decimal"
          suffix="%"
          [minFractionDigits]="2"
          [maxFractionDigits]="2"
          [min]="-100"
          [max]="100"
        />
        <label for="valor">Valor</label>
      </p-floatLabel>
      <div class="flex flex-row">
        <p-button
          *ngIf="atualizacao.isPercentual || atualizacao.atualizaPreco == 0"
          (onClick)="atualizacao.isPercentual = !atualizacao.isPercentual"
          >%</p-button
        >
        <p-button
          *ngIf="!atualizacao.isPercentual && atualizacao.atualizaPreco != 0"
          (onClick)="atualizacao.isPercentual = !atualizacao.isPercentual"
          >R$</p-button
        >
        <p-button
          label="Atualizar Preço"
          icon="pi pi-refresh"
          (onClick)="atualizarPreco()"
        />
      </div>
    </div>
  </ng-template>
  <ng-template pTemplate="header">
    <tr>
      <th>
        <p-checkbox
          [(ngModel)]="atualizacao.all"
          [binary]="true"
          inputId="binary"
          label="Todos"
        />
      </th>
      <th>
        <p-columnFilter type="text" field="nome" ariaLabel="Filter Nome" />
      </th>
      <th>
        <p-columnFilter
          type="text"
          field="codigoBarras"
          ariaLabel="Filter Código de Barras"
        />
      </th>
      <th>
        <p-columnFilter
          type="numeric"
          showButtons="false"
          currency="BRL"
          field="valorProduto"
          ariaLabel="Filter Valor Produto"
        />
      </th>
      <th>
        <p-columnFilter
          type="numeric"
          showButtons="false"
          field="margemLucro"
          ariaLabel="Filter Margem Lucro"
        />
      </th>
      <th>
        <p-columnFilter
          type="numeric"
          currency="BRL"
          showButtons="false"
          field="valorVenda"
          ariaLabel="Filter Valor Venda"
        />
      </th>
      <th>
        <p-columnFilter
          field="tipoProduto"
          matchMode="equals"
          [showMenu]="false"
        >
          <ng-template
            pTemplate="filter"
            let-tipoProduto
            let-filter="filterCallback"
          >
            <p-dropdown
              [ngModel]="tipoProduto"
              [options]="tipoProdutoOptions"
              (onChange)="filter($event.value)"
              [showClear]="true"
            >
              <ng-template let-option pTemplate="item">
                {{ option.label | titlecase }}
              </ng-template>
            </p-dropdown>
          </ng-template>
        </p-columnFilter>
      </th>
      <th>
        <p-columnFilter
          id="atualizaPreco"
          type="boolean"
          field="atualizaPreco"
          placeholder="Buscar por atualização de preço"
          ariaLabel="Filter Atualiza Preço"
        />
      </th>
    </tr>
    <tr>
      <th style="width: 4rem"><p-tableHeaderCheckbox /></th>
      <th pSortableColumn="nome">Nome do Produto<p-sortIcon field="nome" /></th>
      <th pSortableColumn="codigoBarras">
        Código de Barras<p-sortIcon field="codigoBarras" />
      </th>
      <th pSortableColumn="valorProduto">
        Valor Produto<p-sortIcon field="valorProduto" />
      </th>
      <th pSortableColumn="margemLucro">
        Margem de Lucro<p-sortIcon field="margemLucro" />
      </th>
      <th pSortableColumn="valorVenda">
        Valor Venda<p-sortIcon field="valorVenda" />
      </th>
      <th pSortableColumn="tipoProduto">
        Tipo Produto<p-sortIcon field="tipoProduto" />
      </th>
      <th pSortableColumn="atualizaPreco">
        Atualiza Preço<p-sortIcon field="atualizaPreco" />
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-item>
    <tr>
      <td>
        <p-tableCheckbox [value]="item" />
      </td>
      <td>{{ item.nome }}</td>
      <td>{{ item.codigoBarras }}</td>
      <td>{{ item.valorProduto | currency }}</td>
      <td>{{ item.margemLucro }}%</td>
      <td>{{ item.valorVenda | currency }}</td>
      <td>{{ item.tipoProduto | titlecase }}</td>
      <td>
        <i class="pi pi-check" *ngIf="item.atualizaPreco"></i>
        <i class="pi pi-times" *ngIf="!item.atualizaPreco"></i>
      </td>
    </tr>
  </ng-template>
</p-table>
