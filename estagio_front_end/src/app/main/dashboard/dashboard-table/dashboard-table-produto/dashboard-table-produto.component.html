<p-table
  [value]="produtos"
  [lazy]="true"
  [paginator]="true"
  [rows]="rows"
  [totalRecords]="totalProdutos"
  [columns]="selectedColumns"
  sortMode="multiple"
  [rowsPerPageOptions]="[5, 10, 20]"
  (onLazyLoad)="load($event)"
>
  <ng-template pTemplate="caption">
    <p-multiSelect
      display="chip"
      [options]="cols"
      [(ngModel)]="selectedColumns"
      optionLabel="header"
      selectedItemsLabel="{0} columns selected"
      [style]="{ 'min-width': '200px' }"
      placeholder="Choose Columns"
    />
  </ng-template>
  <ng-template pTemplate="header" let-columns>
    <tr>
      <th *ngFor="let col of columns" [pSortableColumn]="col.field">
        {{ col.header }} <p-sortIcon [field]="col.field"></p-sortIcon>
      </th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th *ngFor="let col of columns">
        <p-columnFilter
          *ngIf="isEnum(col)"
          [field]="col.field"
          matchMode="equals"
          [showMenu]="false"
        >
          <ng-template
            pTemplate="filter"
            let-enumer
            let-filter="filterCallback"
          >
            <p-dropdown
              [ngModel]="enumer"
              [options]="enumOptions(col)"
              (onChange)="filter($event.value)"
              [showClear]="true"
            >
              <ng-template let-option pTemplate="item">
                {{ option.label | titlecase }}
              </ng-template>
            </p-dropdown>
          </ng-template>
        </p-columnFilter>
        <p-columnFilter
          *ngIf="isMoney(col)"
          type="numeric"
          currency="BRL"
          [field]="col.field"
          showButtons="false"
        >
        </p-columnFilter>
        <p-columnFilter
          *ngIf="isPercent(col)"
          type="numeric"
          [field]="col.field"
          showButtons="false"
        >
        </p-columnFilter>
        <p-columnFilter
          *ngIf="isBool(col)"
          type="boolean"
          [field]="col.field"
        />
        <p-columnFilter
          *ngIf="!(isEnum(col) || isNumber(col) || isBool(col))"
          type="text"
          [field]="col.field"
          [ariaLabel]="col.header"
        >
        </p-columnFilter>
      </th>
      <th>Editar</th>
      <th>Deletar</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-item let-columns="columns">
    <tr>
      <td *ngFor="let col of columns">
        <div *ngIf="isBool(col)">
          <i class="pi pi-check" *ngIf="item[col.field]"></i>
          <i class="pi pi-times" *ngIf="!item[col.field]"></i>
        </div>
        <div *ngIf="isMoney(col)">
          {{ item[col.field] | currency }}
        </div>
        <div *ngIf="isPercent(col)">{{ item[col.field] }} %</div>
        <div *ngIf="!(isBool(col) || isMoney(col) || isPercent(col))">
          {{ item[col.field] }}
        </div>
      </td>
      <td>
        <p-button
          type="button"
          icon="pi pi-pencil"
          class="p-button-rounded p-button-success"
          (click)="editGrupoProduto(item)"
        ></p-button>
        <p-dialog
          header="Editar Produto"
          [(visible)]="item.edit"
          [modal]="true"
          [resizable]="false"
          [baseZIndex]="10000"
        >
          <app-produto-form
            [produtoPut]="item"
            (produtoChange)="change($event)"
          ></app-produto-form>
        </p-dialog>
      </td>
      <td>
        <p-button (onClick)="remove($event, item)" label="Delete" severity="danger" [outlined]="true"></p-button>
      </td>
    </tr>
  </ng-template>
</p-table>
<p-confirmDialog />
